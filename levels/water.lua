

function loadWaterLevel()
    PATH_POINTS = WATER_PATH_POINTS

    heightAtPoint = function(x, y)
        return {
            height = 0,
            normal = {0,1,0}
        }
    end

    FontColor = {0, 0, 0, 1}
    WorldSize = 50
    RoadScale = 50
    RoadRadius = 2.5
    MaxClosestRoadDistance = RoadRadius + 1

    makeHeightMap()

    updatePathPoints()
    makeRoad(waterRoadImage)

    if CASTLE_SERVER then
        return
    end

    skybox(waterSkyboxImage)
    terrain(waterTerrainImage, true)
    clearItems()
    makeItems(40)
    makeItems(140)
    makeItems(200)

    heightAtPoint = function(x, y)
        -- same as shader
        return {
            height = -0.2 + 0.1 * math.sin(TimeElapsed * 0.5 + y * 0.7) + 0.1 * math.sin(TimeElapsed * 0.7 + 1.0 + x * 1.2),
            normal = {0,1,0}
        }
    end

    FogColor = {1,1,1,1}
    FogStartDist = 5
    FogDivide = 20
end

-- generate with createpath.html
-- format is x,y,angle
WATER_PATH_POINTS = {{0.15789473684210525, 0.078125, -0.0624188099959575},
{0.1710357883539699, 0.07652794930185382, -0.15568567671883904},
{0.18422796726731933, 0.07335808055437867, -0.26796899395097684},
{0.19685193641221166, 0.06840612581315618, -0.38541712889872914},
{0.20917768512485127, 0.06189884368213995, -0.44088519546278704},
{0.22201551226290714, 0.05512603619923735, -0.36445330055642944},
{0.23500955188537867, 0.050299603571007045, -0.218594687043691},
{0.24885813421164127, 0.047643341601479754, -0.08614200691135943},
{0.2631578947368421, 0.046875, 0},
{0.2764638268618887, 0.04666303370864354, -0.027642972443466807},
{0.29055521090495706, 0.04610588165467283, -0.03613659177934747},
{0.3037765599818181, 0.04568139848056808, -0.0033622261638910356},
{0.3172384403915069, 0.046277733168423, 0.1101659927603642},
{0.3304732094983762, 0.049346486401389576, 0.31157517200760365},
{0.3428490199616481, 0.05558004633401146, 0.5101031792027073},
{0.35430483661329953, 0.06431952538046383, 0.642782955859917},
{0.36496318556919444, 0.07449707332707656, 0.7204604808613303},
{0.3684210526315789, 0.078125, 0.7328151017865066},
{0.3821502145980797, 0.09304730517857751, 0.7557583488031772},
{0.3949047604157597, 0.10740472569338293, 0.7738908341112561},
{0.4067481264215519, 0.12123237366679285, 0.7927141505138863},
{0.4177437489523882, 0.13456536122118382, 0.8120914100683603},
{0.42795506434520153, 0.14743880047893246, 0.8318377317837748},
{0.4374455089369243, 0.15988780356241547, 0.8517156972960713},
{0.44627851906448884, 0.17194748259400935, 0.8714332941733879},
{0.45714283311959486, 0.18748212706322953, 0.8968706227344617},
{0.4671015181175471, 0.20247029017006096, 0.9204615945609715},
{0.47630494167181503, 0.21699520064902594, 0.9411702324146438},
{0.48490347139586837, 0.23114008723464669, 0.9579484304506113},
{0.49304747490317646, 0.2449881786614457, 0.9698389004620313},
{0.5008873198072095, 0.25862270366394524, 0.9760846602915709},
{0.5085733737214362, 0.2721268909766675, 0.9762257459128652},
{0.5162560042593267, 0.285583969334135, 0.9701640756173371},
{0.5240855790343506, 0.2990771674708699, 0.9581824968653266},
{0.5322124656599773, 0.3126897141213945, 0.9409128878651455},
{0.5407870317496764, 0.32650483802023134, 0.9192587853991486},
{0.5499596449169174, 0.34060576790190256, 0.8942877375223823},
{0.5598806727751702, 0.35507573250093044, 0.8671145150266382},
{0.5707004829379041, 0.3699979605518374, 0.8387963575592567},
{0.5825694430185887, 0.3854556807891457, 0.8102556682167543},
{0.5922501232302352, 0.39745045500006404, 0.7891589381639931},
{0.6026689683902382, 0.4098283718513785, 0.7686029230578155},
{0.6138894148355301, 0.4226245434654656, 0.7487727371230254},
{0.6259748989030434, 0.43587408196470234, 0.729800626808348},
{0.6389888569297104, 0.4496120994714648, 0.7117730313355812},
{0.6578947368421053, 0.46875, 0.6947382761967029},
{0.6708820655409186, 0.4811548111884959, 0.6497315131799927},
{0.683240514880808, 0.49208958920026513, 0.6107186594792892},
{0.695025362463923, 0.5016791773715272, 0.5694218742832939},
{0.7062918858924129, 0.510048419038502, 0.5264633364532685},
{0.7197303588076087, 0.5189840498705894, 0.47183230478510296},
{0.732553285551259, 0.5264517916436258, 0.4184144100025613},
{0.7448686301900624, 0.5326954789986657, 0.3691234866516797},
{0.7591290487841398, 0.5389154711675631, 0.3198325967307003},
{0.7730005793105372, 0.5441452931174062, 0.28596452518142046},
{0.7866697836765082, 0.5488062911079366, 0.2710751403544347},
{0.8003232237893084, 0.5533198113988967, 0.27661850616306083},
{0.8141474615561911, 0.5581072002500285, 0.30171308736179436},
{0.8283290588844108, 0.5635898039210738, 0.3433526442039354},
{0.8430545776812222, 0.5701889686717746, 0.39701691519295546},
{0.855875934114667, 0.5768451817523881, 0.4472147999472138},
{0.869312534736925, 0.5848132206819708, 0.49936226627362235},
{0.8834723436146943, 0.5943369201015775, 0.5510917592233584},
{0.8953934525136988, 0.6032398120688685, 0.5909740139738142},
{0.9079017893010668, 0.6134192242562693, 0.6288459598488019},
{0.9210526315789473, 0.625, 0.655695626241536},
{0.932953545284827, 0.6358817632000029, 0.659126224740087},
{0.9440119415542808, 0.6461362803936337, 0.6722453650940792},
{0.9555817742980318, 0.6572867800570423, 0.7014519664922659},
{0.9659711461024774, 0.6680524365972944, 0.7489634286001263},
{0.9761950247428081, 0.6799922724264458, 0.8282863892394688},
{0.9848100894728107, 0.692068158014606, 0.937797588277477},
{0.9924215865061368, 0.7060466055376781, 1.092620403945253},
{0.9978885008145547, 0.721052799306317, 1.2692693181093304},
{1.0011274678127182, 0.7375392569942714, 1.445385492407725},
{1.00206874233101, 0.7540167004217994, 1.586342892997598},
{1.0012846091737422, 0.7702442920341716, 1.6911214392288823},
{1, 0.78125, 1.7359450042095237},
{0.9974602299776664, 0.7977727890935749, 1.773747856249543},
{0.9945411384297115, 0.8138049830714815, 1.8077640683448883},
{0.9912350828499472, 0.8293303602583733, 1.8442557519847536},
{0.9875344207321863, 0.844332698978905, 1.883402552121535},
{0.9825619849120064, 0.8616222545490597, 1.93412871506396},
{0.9769971042175098, 0.8781072444601588, 1.9892042467290052},
{0.970826572398005, 0.8937596376572048, 2.048848997217543},
{0.9640371832027997, 0.9085514030851993, 2.1131921699488707},
{0.9566157303812023, 0.9224545096891443, 2.18223032768755},
{0.948549007682521, 0.9354409264140422, 2.255782942654223},
{0.9398238088560642, 0.9474826222048944, 2.3334529572550924},
{0.9304269276511397, 0.9585515660067034, 2.414602863532669},
{0.9203451578170556, 0.9686197267644714, 2.4983576657400874},
{0.9095652931031207, 0.9776590734231998, 2.5836428318383025},
{0.8980741272586428, 0.9856415749278911, 2.6692573864438205},
{0.8858584540329297, 0.9925392002235469, 2.7539717740096905},
{0.8729050671752904, 0.99832391825517, 2.8366315760525707},
{0.868421052631579, 1, 2.8501358591119264},
{0.8552412132272902, 1.003257289137832, 3.051410608247523},
{0.8410940578659293, 1.003390966541131, 3.265903276613665},
{0.8276244392532943, 1.0000431778256462, 3.473703276443457},
{0.814788080645023, 0.9934808068592169, 3.6579471030244948},
{0.8025407052967538, 0.9839707375096831, 3.8111006552987092},
{0.792112810602787, 0.9732584840261274, 3.921490403911619},
{0.7820842043311726, 0.9606154971811731, 4.01077618552762},
{0.7736122687768457, 0.9481164325571804, 4.074434365356982},
{0.765401397258871, 0.9344082306462497, 4.126941038839309},
{0.7574307572349767, 0.9196164623217269, 4.170188119204792},
{0.7496795161628905, 0.9038666984569572, 4.205709309680369},
{0.7431944274680207, 0.889699599530835, 4.230933728472191},
{0.7368421052631579, 0.875, 4.2487413713838835},
{0.7310672773519151, 0.8588929331269647, 4.390517878936278},
{0.7268250179633591, 0.8420468786084501, 4.491260388102488},
{0.7239381277548932, 0.8246482829270002, 4.576486174988198},
{0.7222294073839225, 0.8068835925651617, 4.647395250703648},
{0.7215216575078504, 0.7889392540054796, 4.705441270724607},
{0.7216376787840815, 0.7710017137304995, -1.5312143431932554},
{0.72240027187002, 0.7532574182227674, -1.4951601194502144},
{0.7236322374230697, 0.7358928139648283, -1.4689653972332817},
{0.725156376100635, 0.7190943474392277, -1.4525488823695087},
{0.7267954885601199, 0.7030484651285113, -1.4465310720884421},
{0.7286646922292612, 0.6850493341667232, -1.4554428717823105},
{0.7301380906270233, 0.6687245869310725, -1.4879270419015151},
{0.7309482979886217, 0.6522251047677766, 4.70906894561942},
{0.7298034694001468, 0.6358279590064129, 4.431959785100155},
{0.7208509873049503, 0.6234928899092369, 3.2396926134948965},
{0.7105263157894737, 0.625, 2.819842099193151},
{0.6980607792597717, 0.6313746057189505, 2.6189975298758883},
{0.6859803405694461, 0.6403068278657115, 2.489981757096887},
{0.6742444064042442, 0.6515568185831881, 2.3870642435878318},
{0.6628123834499133, 0.6648847300142864, 2.3062079517526612},
{0.6516436783922018, 0.6800507143019121, 2.24331101685874},
{0.6434155325529687, 0.6924871543531941, 2.205811654790609},
{0.6352955439868663, 0.7057214101519456, 2.1752782769543644},
{0.6272665873894443, 0.7196522958834549, 2.1507696722149263},
{0.6193115374562523, 0.7341786257330103, 2.131545950456257},
{0.6114132688828402, 0.7491992138859003, 2.117038510870115},
{0.6035546563647572, 0.7646128745274132, 2.1068239967717957},
{0.5957185745975538, 0.7803184218428374, 2.10060363810521},
{0.587887898276779, 0.7962146700174613, 2.0981880844697365},
{0.5800455020979828, 0.812200433236573, 2.0994873791360855},
{0.572174260756715, 0.8281745256854611, 2.1045056597546075},
{0.564257048948525, 0.8440357615494138, 2.113340264806344},
{0.5562767413689628, 0.8596829550137196, 2.1261850584898454},
{0.5482162127135778, 0.8750149202636667, 2.1433378857132626},
{0.54005833767792, 0.8899304714845437, 2.165212054914168},
{0.531785990957539, 0.9043284228616386, 2.192351495144707},
{0.5233820472479844, 0.9181075885802402, 2.225448519731944},
{0.514829381244806, 0.9311667828256365, 2.2653615473830087},
{0.5061108676435535, 0.9434048197831162, 2.3131270050426744},
{0.4941985983976813, 0.9582699575494203, 2.391139255510454},
{0.48192045067751316, 0.9712555263872907, 2.48845028140179},
{0.46923583116879647, 0.9821216784396333, 2.6080329396230817},
{0.45610414655727866, 0.9906285658493534, 2.7513659208869408},
{0.4424848035287072, 0.9965363407593568, 2.916406827949093},
{0.42833720876882964, 0.9996051553125496, 3.0958343909966475},
{0.42105263157894735, 1, 3.141592653589793},
{0.4069067032692077, 0.9985235265872087, 3.3673466692464054},
{0.3924079077235478, 0.9930186243442753, 3.6280056918818318},
{0.3802755379054546, 0.9837189819988972, 3.8831398153032426},
{0.3701548746386527, 0.9709187088323293, 4.094792246346531},
{0.36300179649653347, 0.9577899068609559, 4.228343273773666},
{0.35679412673042216, 0.942604555950537, 4.326246639415482},
{0.351326588039233, 0.9255328582314283, 4.394922105046124},
{0.347347505113896, 0.9106317061854827, 4.432940916570149},
{0.3436056266256583, 0.8947193650361441, 4.458671519887795},
{0.33999585059636417, 0.8778829782741548, 4.474061974266222},
{0.33641307504785756, 0.8602096893902562, 4.480587231444874},
{0.33275219800198275, 0.8417866418751903, 4.479346628687278},
{0.32890811748058363, 0.8227009792196988, 4.4711512234949975},
{0.32477573150550443, 0.8030398449145233, 4.456595872314125},
{0.32024993809858926, 0.7828903824504059, 4.43611762669676},
{0.3165341940075261, 0.7675102425041616, 4.4170718824352075},
{0.312493698476308, 0.7519411998422114, 4.394991022956859},
{0.3080841116079004, 0.736220018124712, 4.369973143860536},
{0.3032610935052687, 0.7203834610118198, 4.342111620208279},
{0.29798030427137856, 0.704468292163692, 4.311502852189433},
{0.29219740400919547, 0.688511275240485, 4.278253571924644},
{0.2858680528216847, 0.6725491739023557, 4.242487586812991},
{0.2789479108118119, 0.6566187518094605, 4.204351715434343},
{0.2713926380825425, 0.6407567726219563, 4.164020570515159},
{0.2631578947368421, 0.625, 4.1360137597935065},
{0.25425856755994053, 0.6091952295549834, 4.102401393002296},
{0.2456907909909292, 0.5948508823529476, 4.073568493865135},
{0.23742795958230328, 0.5818395637366015, 4.0433191186751944},
{0.2274877177168806, 0.5672559091165787, 4.004250576364965},
{0.21793041788817757, 0.5543072398196587, 3.9650800101839616},
{0.2087040963315369, 0.5427447381558199, 3.927671053035382},
{0.1979962368020534, 0.5303491421273316, 3.888322503368565},
{0.1876003647779059, 0.5191613730484941, 3.8590093009979625},
{0.1774266868737668, 0.5087514739509507, 3.84346722810328},
{0.1657184308662701, 0.4970161251821129, 3.8457480949520964},
{0.15571813235859513, 0.48681661977759605, 3.865309502947907},
{0.14565568225072464, 0.47603345395457825, 3.8988516529939066},
{0.1354412871573311, 0.4642366707447033, 3.9425426490293596},
{0.12498515369308695, 0.45099631317961497, 3.9919081908953453},
{0.11602226639076665, 0.43854975874491603, 4.034359659550093},
{0.10677718493755434, 0.42455332320105016, 4.075948615805617},
{0.09719794556879283, 0.40875818885799664, 4.115340955583087},
{0.0892590407247386, 0.39465981276044443, 4.144720583209447},
{0.07894736842105263, 0.375, 4.171969480114106},
{0.07211481209029169, 0.3612932908310357, 4.187526167243616},
{0.06489103791113841, 0.3462585648747333, 4.20837334503726},
{0.05769883006070308, 0.3303799091875744, 4.240552940220399},
{0.051706532022870136, 0.31594774620973964, 4.2820096983684275},
{0.04615147831827865, 0.30076279123964433, 4.34019485690356},
{0.04130619704771944, 0.28470564698110157, 4.414716834245352},
{0.03766688252508652, 0.2689972508826877, 4.488764653258679},
{0.03494195063681564, 0.25287170562596734, 4.550690526391469},
{0.03283981726934247, 0.2355631138925049, 4.593220344100201},
{0.0312583769881514, 0.21856536258013923, 4.614025542735611},
{0.029928301518114937, 0.20200625389390195, 4.6211055474230545},
{0.028718922898072142, 0.1862734008346487, 4.620810264087243},
{0.02735436715606642, 0.1688800866473092, 4.616216177068884},
{0.02631578947368421, 0.15625, 4.612720327893528},
{0.025151354442602726, 0.1399855034184638, 4.650892542453981},
{0.02467952597673095, 0.12405440224053463, -1.5613880147859036},
{0.02552818170655773, 0.10775450179989125, -1.425082055411424},
{0.028837301480684262, 0.09183203803135925, -1.185293620557669},
{0.0357581143361745, 0.07773895154263594, -0.8578620804324228},
{0.046207867619574454, 0.06685647464146019, -0.5636292637364879},
{0.05263157894736842, 0.0625, -0.46364760900080615},
{0.06511506728374221, 0.05716515397609364, -0.18638752661003477},
{0.0791149324875714, 0.056469761296156176, 0.14132791489817964},
{0.09239403795189884, 0.060360426186707596, 0.34038717218607806},
{0.10514138295740635, 0.0661909780056987, 0.37829260951555255},
{0.11811219675827193, 0.07190677852861127, 0.3087389732459629},
{0.13171191726041973, 0.07617124153445379, 0.1809120775824109},
{0.14606193466630393, 0.07823887899901791, 0.03450629828930585}}